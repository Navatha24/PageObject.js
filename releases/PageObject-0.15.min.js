/*
 * PageObject v0.15
 *
 * Copyright 2011, Mykhaylo Gavrylyuk, https://github.com/IronGroove
 * Licensed under the MIT license
 *
 * Date: Fri May 31 00:15:25 EEST 2013
 */

(function(e,t){"use strict";function i(e,t){this.name="PageObjectError";this.code=e<10?"0"+e:e;this.message=t}var n={},r;i.prototype=new Error;i.prototype.constructor=new i;i.prototype.toString=function(){return"POE"+this.code+": "+this.message};r=i;n.defaultOptions={container:undefined,containerClass:undefined,containerElement:"div",templateEngine:undefined,template:undefined,context:{},selectors:{},hide:false};if(e._&&t.isFunction(e._.template)){n.defaultOptions.templateEngine=e._.template}t.extractParts=function(e,n){var i={};if(!t.isElement(e)){throw new r(10,"arguments should be: 1st — HTML DOM container, 2nd — selectors map")}if(!t.isPlainObject(n)){n={}}t.each(n,function(n,s){var o,u=false;if(!/^[A-z\.]+$/.test(n)){throw new r(11,"incorrect selector name `"+n+"`")}if(t.isArray(s)&&s.length===2&&t.type(s[0])==="string"&&t.isFunction(s[1])){i[n]={};t(e).find(s[0]).each(function(){var e=s[1].call(this,this);if(e){if(i[n][e]){throw new r(12,"duplicate identifier `"+e+"` in DOM part namespace `"+n+"`")}i[n][e]=this}})}else if(t.isPlainObject(s)){i[n]=t.extractParts(e,s)}else if(typeof s==="string"){u=s.indexOf("[]")===0;if(u){s=s.replace("[]","")}o=t(e).find(s);if(o.length===0){throw new r(13,"DOM parts weren't found for selector `"+n+"`")}else if(o.length>1){if(u){o=Array.prototype.slice.call(o)}else{throw new r(14,"multiple DOM parts found for selector `"+n+"`")}}else{o=o[0]}i[n]=o}else{throw new r(15,"invalid selector value")}});return i};t.isElement=function(t){return typeof e.HTMLElement==="object"?t instanceof e.HTMLElement:typeof t==="object"&&t!==null&&t.nodeType===1&&typeof t.nodeName==="string"};t.isPageObject=function(e){return e&&e.DOM&&t.isPlainObject(e.DOM)&&t.isElement(e.DOM.container)};t.turnToPageObject=function(i,s){var o,u,a;if(t.type(i)!=="object"){throw new r(1,"invalid target (1st argument should be an object)!")}if(!t.isPlainObject(s)){s={}}o=t.extend({},n.defaultOptions,s);if(!t.isPlainObject(i.DOM)){i.DOM={}}if(o.container!==undefined){if(!t.isElement(o.container)){throw new r(2,"container is invalid!")}i.DOM.container=o.container}else{i.DOM.container=e.document.createElement(o.containerElement)}if(o.containerClass){t(i.DOM.container).addClass(o.containerClass)}t(i.DOM.container).data("pageObject",i);if(o.template!==undefined){if(typeof o.template==="string"){if(!t.isFunction(o.templateEngine)){throw new r(3,"templateEngine not configured")}}else if(typeof o.template!=="function"){throw new r(4,"invalid template")}if(!t.isPlainObject(o.context)){o.context={}}try{if(typeof o.template==="string"){u=o.templateEngine(o.template,o.context)}else{u=o.template(o.context)}}catch(f){throw new r(5,"template error: "+f)}t(i.DOM.container).html(u)}if(!t.isPlainObject(o.selectors)){o.selectors={}}a=t.extractParts(i.DOM.container,o.selectors);t.extend(true,i.DOM,a);if(o.hide){t(i.DOM.container).hide()}return i};t.turnToPageObject.configure=function(e){if(t.isPlainObject(e)){t.extend(n.defaultOptions,e)}}})(window,jQuery);
