/*
 * PageObject v0.16
 *
 * Copyright 2011-2013, Mykhaylo Gavrylyuk, https://github.com/IronGroove
 * Licensed under the MIT license
 *
 * Date: Thu Aug 01 00:05:21 EEST 2013
 */

(function(e,t){"use strict";function i(e,t){this.name="PageObjectError";this.code=e<10?"0"+e:e;this.message=t}function s(){}var n={},r;s.prototype=Error.prototype;i.prototype=new s;i.prototype.constructor=new i;i.prototype.toString=function(){return"PageObjectError #"+this.code+": "+this.message};r=i;n.defaultOptions={container:undefined,containerClass:undefined,containerElement:"div",templateEngine:undefined,template:undefined,context:{},selectors:{},namespace:"DOM",hide:false};if(e._&&t.isFunction(e._.template)){n.defaultOptions.templateEngine=e._.template}t.extractParts=function(e,n){var i={};if(!t.isElement(e)){throw new r(10,"arguments should be: 1st — HTML DOM container, 2nd — selectors map")}if(!t.isPlainObject(n)){n={}}t.each(n,function(n,s){var o,u,a;if(!/^[A-z\.]+$/.test(n)){throw new r(11,"incorrect selector name `"+n+"`")}if(t.isArray(s)&&s.length===2&&t.type(s[0])==="string"&&t.isFunction(s[1])){s[0]=t.trim(s[0]);if(s[0].indexOf("?")===0||s[0].indexOf("[]")===0){throw new r(12,"[] and ? features are unavailable when selector is an array")}i[n]={};t(e).find(s[0]).each(function(){var e=s[1].call(this,this);if(e){if(i[n][e]){throw new r(13,"duplicate identifier `"+e+"` in DOM part namespace `"+n+"`")}i[n][e]=this}})}else if(t.isPlainObject(s)){i[n]=t.extractParts(e,s)}else if(typeof s==="string"){while(true){s=t.trim(s);if(s.indexOf("?")===0){u=true;s=t.trim(s.substring(1));continue}if(s.indexOf("[]")===0){a=true;s=t.trim(s.substring(2));continue}break}o=t(e).find(s);o=t.makeArray(o);if(o.length==0){if(u){o=undefined}else{throw new r(14,"DOM parts weren't found for selector `"+n+"`")}}else if(o.length==1){if(!a){o=o[0]}}else if(o.length>1){if(!a){throw new r(15,"multiple DOM parts found for selector `"+n+"`")}}i[n]=o}else{throw new r(16,"invalid selector value")}});return i};t.isElement=function(t){return typeof e.HTMLElement==="object"?t instanceof e.HTMLElement:typeof t==="object"&&t!==null&&t.nodeType===1&&typeof t.nodeName==="string"};t.isPageObject=function(e){return e&&e.DOM&&t.isPlainObject(e.DOM)&&t.isElement(e.DOM.container)};t.turnToPageObject=function(i,s){var o,u,a,f;if(t.type(i)!=="object"){throw new r(1,"invalid target (1st argument should be an object)!")}if(!t.isPlainObject(s)){s={}}o=t.extend({},n.defaultOptions,s);if(s.namespace===null){f=i}else{if(!t.isPlainObject(i[o.namespace])){i[o.namespace]={}}f=i[o.namespace]}if(o.container!==undefined){if(!t.isElement(o.container)){throw new r(2,"container is invalid!")}f.container=o.container}else{f.container=e.document.createElement(o.containerElement)}if(o.containerClass){t(f.container).addClass(o.containerClass)}t(f.container).data("pageObject",i);if(o.template!==undefined){if(typeof o.template==="string"){if(!t.isFunction(o.templateEngine)){throw new r(3,"templateEngine not configured")}}else if(typeof o.template!=="function"){throw new r(4,"invalid template")}if(!t.isPlainObject(o.context)){o.context={}}try{if(typeof o.template==="string"){u=o.templateEngine(o.template,o.context)}else{u=o.template(o.context)}}catch(l){throw new r(5,"template error: "+l)}t(f.container).html(u)}if(!t.isPlainObject(o.selectors)){o.selectors={}}a=t.extractParts(f.container,o.selectors);t.extend(true,f,a);if(o.hide){t(f.container).hide()}return i};t.turnToPageObject.configure=function(e){if(t.isPlainObject(e)){t.extend(n.defaultOptions,e)}};t.PageObject=function o(e){if(!(this instanceof o)){return new o(e)}if(!t.isPlainObject(e)){e={}}e.namespace=null;t.turnToPageObject(this,e)}})(window,jQuery)
